@model BookViewModel
@section Style{
    <link href="~/css/pagination.css" rel="stylesheet" />
}

<div class="container" style="margin-top: 35px;">
    <div class="row">

        <div class="col-lg-10 col-md-12 col-sm-12">

            <nav aria-label="Page navigation example">
                <ul class="pagination">
                    <li id='previous-page' class="page-item-arrow">
                        <a class="page-link" href="javascript:void(0)" aria-label="Previous">
                            <span aria-hidden="true">&laquo;</span>
                        </a>
                    </li>
                </ul>
            </nav>

            <div id="loop">
                @for (int i = 0; i < Model.Books.Count; i++)
                {
                    <div class="row">
                        @for (int j = 0; j < 3; j++)
                        {
                            @if (i < Model.Books.Count)
                            {
                                <div class="list-group col-lg-3">
                                    <div class="list-group-item active">
                                        <div class="content">
                                            <img src="@("~/img/" + Model.Books[i].Image)" asp-append-version="true" alt="Alternative Text">
                                            <div class="text">
                                                <p>
                                                    @Model.Books[i].Title <br>
                                                    @Model.Books[i].Price RSD
                                                </p>
                                            </div>
                                        </div>
                                        <div class="description">
                                            <div class="d-text">
                                                <button>Show more</button>
                                                <button>Wish list</button>
                                                <button class="btn" onclick="AddToCart(@Model.Books[i].BookId)">Add to cart</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                            else
                            {
                                <div class="list-group col-lg-3">
                                </div>
                            }
                            i++;
                        }
                        @{i--;}
                    </div>
                }
            </div>
        </div>
        <div class="col-lg-2 col-md-12">
            <div id="myDropdown" class="dropdown-content">
                <select id="autors" onchange="filterFunction()">
                    @foreach (var item in Model.Autors)
                    {
                        <option id="@item.FirstName.ToLower() @item.LastName.ToLower()" value="@item.FirstName.ToLower() @item.LastName.ToLower()">@item.FirstName @item.LastName</option>
                    }
                </select>
            </div>
        </div>
    </div>
</div>

@section JavaScript{
    <script src="~/js/Pagination.js"></script>
    <script>
        function partialLoad() {
            var numberOfItems = $("#loop .list-group").length;
            var limitPerPage = 6;

            $(`#loop .list-group:gt(${limitPerPage - 1})`).hide();
            var totalPages = Math.round(numberOfItems / limitPerPage);

            //inserted first item
            $('.pagination').append(`<li class="page-item active"><a class="page-link" href="javascript:void(0)">1</a></li>`);
            //loop throught other items
            for (var i = 2; i <= totalPages; i++) {
                $('.pagination').append(`<li class="page-item"><a class="page-link" href="javascript:void(0)">${i}</a></li>`);
            }
            //insert right arrow
            $('.pagination').append(`<li id='next-page' class="page-item-arrow"><a class="page-link" href="javascript:void(0)" aria-label="Next">    <span aria-hidden="true">&raquo;</span></a></li>`);

            $('.pagination li.page-item').on("click", function () {
                if ($(this).hasClass("active"))
                    return false;
                else {
                    var currentPage = $(this).index();
                    $('.pagination li').removeClass("active");
                    $(this).addClass("active")
                    $(`#loop .list-group`).hide();
                    var grandTotal = limitPerPage * currentPage;

                    for (var i = grandTotal - limitPerPage; i < grandTotal; i++) {
                        $(`#loop .list-group:eq(${i})`).show();
                    }
                }
            });

            $('#next-page').on("click", function () {
                var currentPage = $('.pagination li.active').index();
                if (currentPage === totalPages)
                    return false;
                else {
                    currentPage++;
                    $('.pagination li').removeClass("active");
                    $(`#loop .list-group`).hide();

                    var grandTotal = limitPerPage * currentPage;

                    for (var i = grandTotal - limitPerPage; i < grandTotal; i++) {
                        $(`#loop .list-group:eq(${i})`).show();
                    }

                    $(`.pagination li.page-item:eq(${currentPage - 1})`).addClass("active");
                }
            });

            $('#previous-page').on("click", function () {
                var currentPage = $('.pagination li.active').index();
                if (currentPage === 1)
                    return false;
                else {
                    currentPage--;
                    $('.pagination li').removeClass("active");
                    $(`#loop .list-group`).hide();

                    var grandTotal = limitPerPage * currentPage;

                    for (var i = grandTotal - limitPerPage; i < grandTotal; i++) {
                        $(`#loop .list-group:eq(${i})`).show();
                    }

                    $(`.pagination li.page-item:eq(${currentPage - 1})`).addClass("active");
                }
            });
        }

        function filterFunction() {
            var nameLastName = $("#autors").val();
            $.ajax({
                url: '@Url.ActionLink("SearchBooks", "Book")',
                data: { autor: nameLastName },
                method: "post",
                success: function (data) {
                    document.getElementById("main").innerHTML = "";
                    $("#main").append(data);//.html(data)
                    partialLoad();
                    var options = document.getElementById('autors').getElementsByTagName('option');
                    for (var i = 0; i < options.length; i++) {
                        if (options[i].id == nameLastName)
                            options[i].selected = 'selected';
                        else
                            options[i].selected = '';
                    }
                },
                error: function () {
                    alert("Error!");
                }
             });
        }


        function AddToCart(id) {
            $.ajax({
                 url: '@Url.ActionLink("AddBookToCart", "Book")',
                data: { bookId: id },
                method: "post",
                success: function () {
                },
                error: function () {
                    alert("Error!");
                }
            });
        }
    </script>
}
