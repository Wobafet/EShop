@section Style{
    <link href="~/css/pagination.css" rel="stylesheet" />
}

<div class="container" style="margin-top: 35px;">
    <div class="row">

        <div class="col-lg-10 col-md-12 col-sm-12">

            <nav aria-label="Page navigation example">
                <ul class="pagination">
                    <li id='previous-page' class="page-item-arrow">
                        <a class="page-link" href="javascript:void(0)" aria-label="Previous">
                            <span aria-hidden="true">&laquo;</span>
                        </a>
                    </li>
                </ul>
            </nav>

            <div id="loop">

            </div>
        </div>
        <div class="col-lg-2 col-md-12">
            <div id="myDropdown" class="dropdown-content">
                <select id="autors" onchange="filterFunction()">
                    <option id="all">All</option>

                </select>
            </div>
        </div>
    </div>
</div>

@section JavaScript{
    <script>

    var limitPerPage = 6;
    var totalPages;

    function GetAllAutors(nameLastName) {
        $.ajax({
            url: '@Url.ActionLink("GetAllAutors", "Book")',
            data: {},
            method: "get",
            success: function (data) {
                for (var i = 0; i < data.length; i++)
                {
                    $option = `<option id="${data[i].firstName.toLowerCase() + " " + data[i].lastName.toLowerCase()}" value="${data[i].firstName.toLowerCase() + " " + data[i].lastName.toLowerCase()}">${data[i].firstName + " " + data[i].lastName}</option>`;
                    $("#autors").append($option);
                }
                if (nameLastName != null) {
                    var options = $("#autors option");
                    for (var i = 0; i < options.length; i++) {
                        if (options[i].id == nameLastName) {
                            options[i].selected = 'selected';
                            return;
                        }
                        else
                            options[i].selected = '';
                    }
                }
            },
            error: function () {
                alert("Error!");
            }
        });
    }
    GetAllAutors(null);

    function GetNumberOfBooks() {
        $.ajax({
            url: '@Url.ActionLink("NubmerOfBooks", "Book")',
            data: {},
            method: "get",
            success: function (totalNumberOfBooks) {
                partialLoad(totalNumberOfBooks, false, "all");
            },
            error: function () {
                alert("Error!");
            }
        });
    }
    GetNumberOfBooks();

    function pastePicture(image, title, price, bookId) {
        return text =`<div class="list-group col-lg-3">
                        <div class="list-group-item active">
                            <div class="content">
                                <img src="img/${image}" asp-append-version="true" alt="Alternative Text">
                                <div class="text">
                                    <p>
                                        ${title} <br>
                                        ${price} RSD
                                    </p>
                                </div>
                            </div>
                            <div class="description">
                                <div class="d-text">
                                    <button>Show more</button>
                                    <button>Wish list</button>
                                    <button class="btn" onclick="AddToCart(${bookId})">Add to cart</button>
                                </div>
                            </div>
                        </div>
                    </div>`;
    }
    function mainPart() {
        return text =`<div class="container" style="margin-top: 35px;">
                        <div class="row">

                            <div class="col-lg-10 col-md-12 col-sm-12">

                                <nav aria-label="Page navigation example">
                                    <ul class="pagination">
                                        <li id='previous-page' class="page-item-arrow">
                                            <a class="page-link" href="javascript:void(0)" aria-label="Previous">
                                                <span aria-hidden="true">&laquo;</span>
                                            </a>
                                        </li>
                                    </ul>
                                </nav>

                                <div id="loop">

                                </div>
                            </div>
                            <div class="col-lg-2 col-md-12">
                                <div id="myDropdown" class="dropdown-content">
                                    <select id="autors" onchange="filterFunction()">
                                        <option id="all">All</option>

                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>`;
    }

    function partialLoad(numberOfBooks, searching, autorName) {
        totalPages = Math.ceil(numberOfBooks / limitPerPage);
        //inserted first item
        $('.pagination').append(`<li class="page-item active"><a name="pagiNum" class="page-link" href="javascript:void(0)">1</a></li>`);
        //loop throught other items
        for (var i = 2; i <= totalPages; i++) {
            $('.pagination').append(`<li class="page-item"><a name="pagiNum" class="page-link" href="javascript:void(0)">${i}</a></li>`);
        }
        //insert right arrow
        $('.pagination').append(`<li id='next-page' class="page-item-arrow"><a class="page-link" href="javascript:void(0)" aria-label="Next">    <span aria-hidden="true">&raquo;</span></a></li>`);

        //if (searching) {
        //    GetSixBooks(1, autorName);
        //    //PasteThisBooks(data);//treba da se doda i naziv autora
        //    //ako je true radi ajax da vrati 6 kniga za tog autora
        //}
        //else
        GetSixBooks(1, autorName);
    }


    function PasteThisBooks(data) {
        for (var i = 0; i < limitPerPage; i++) {
            var $div = $("<div>", { "class": "row" });
            for (var j = 0; j < 3; j++) {
                if (i < data.length) {
                    $div.append(pastePicture(data[i].image, data[i].title, data[i].price, data[i].bookId));
                }
                else {
                    $div.append(`<div class="list-group col-lg-3"></div>`);
                }
                i++;
            }
            i--;
            $("#loop").append($div);
        }
    }

  

    function GetSixBooks(pageNumber, autorName) {
         $.ajax({
            url: '@Url.ActionLink("ReturnSixBooks", "Book")',
            data: { pagiNumber: pageNumber, autor: autorName },
            method: "get",
            success: function (data) {
                $("#loop").html("");
                PasteThisBooks(data);
            },
            error: function () {
                alert("Error!");
            }
        });
    }

    function clickOnNumber() {
        $('.pagination li.page-item').on("click", function () {
            if ($(this).hasClass("active"))
                return false;
            else {
                var nameLastName = $("#autors").val();
                var currentPage = $(this).index();
                $('.pagination li').removeClass("active");
                $(this).addClass("active");
                GetSixBooks(currentPage, nameLastName);
            }
        });
    }

    function filterFunction() {
        var nameLastName = $("#autors").val();
        $.ajax({
            url: '@Url.ActionLink("NubmerOfBooksByAutor", "Book")',
            data: { autor: nameLastName },
            method: "get",
            success: function (data) {
                document.getElementById("main").innerHTML = "";
                $("#main").append(mainPart());
                partialLoad(data, true, nameLastName);
                GetAllAutors(nameLastName);
            },
            error: function () {
                alert("Error!");
            }
        });
    }







    function addFunctions() {
        $(document).on("click", "a[name='pagiNum']", function (e) {
            clickOnNumber()
        });

        $(document).on("click", "#next-page", function (e) {
            var currentPage = $('.pagination li.active').index();
            if (currentPage === totalPages)
                return false;
            else {
                var nameLastName = $("#autors").val();
                currentPage++;
                $('.pagination li').removeClass("active");
                GetSixBooks(currentPage, nameLastName);
                $(`.pagination li.page-item:eq(${currentPage - 1})`).addClass("active");
            }
        });

        $(document).on("click", "#previous-page", function (e) {
            var currentPage = $('.pagination li.active').index();
            if (currentPage === 1)
                return false;
            else {
                var nameLastName = $("#autors").val();
                currentPage--;
                $('.pagination li').removeClass("active");
                GetSixBooks(currentPage, nameLastName);
                $(`.pagination li.page-item:eq(${currentPage - 1})`).addClass("active");
            }
        });

        //$('#previous-page').on("click", function () {
        //    var currentPage = $('.pagination li.active').index();
        //    if (currentPage === 1)
        //        return false;
        //    else {
        //        var nameLastName = $("#autors").val();
        //        currentPage--;
        //        $('.pagination li').removeClass("active");
        //        GetSixBooks(currentPage, nameLastName);
        //        $(`.pagination li.page-item:eq(${currentPage - 1})`).addClass("active");
        //    }
        //});
    }
        window.onload = addFunctions();
    function AddToCart(id) {
            $.ajax({
                 url: '@Url.ActionLink("AddBookToCart", "Book")',
                data: { bookId: id },
                method: "post",
                success: function () {
                },
                error: function () {
                    alert("Error!");
                }
            });
        }
    </script>
}
